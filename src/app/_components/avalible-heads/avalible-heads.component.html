<div class="action-bar">
    <button class="btn btn-success" (click)="save()">Save</button>
    <a class="btn btn-primary" routerLink="/cloud">Sync...</a>
</div>
<table class="table table-striped table-sm table-fit table-dark">
    <thead>
        <tr>
            <td class="verysmallwidth"><button class="action-btn green" (click)="addHead()"><i class="fas fa-plus"></i></button></td>
            <td class="middlewidth">Name</td>
            <td class="middlewidth">Manufacturer</td>
            <td class="">Channels</td>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let head of heads; let i = index">
            <td><button class="action-btn red" (click)="deleteHead(i)"><i class="fas fa-times"></i></button></td>
            <td class="editable" (click)="change('name', i)"><i class="fas fa-pen"></i> {{head.name}}</td>
            <td class="editable" (click)="change('manufacturer', i)"><i class="fas fa-pen"></i> {{head.manufacturer}}</td>
            <td>
                <button class="action-btn blue" (click)="toggleShowChannelModes(i)"><i [class]='head.showChannelModes ? "fas fa-eye-slash" : "fas fa-eye"'></i></button>
                <table class="fullwidth" *ngIf="head.showChannelModes">
                    <thead>
                        <tr>
                            <td class="verysmallwidth"><button class="action-btn green" (click)="addChannelMode(i)"><i class="fas fa-plus"></i></button></td>
                            <td class="smallwidth">Channel Mode</td>
                            <td>Channel Config</td>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr *ngFor="let channelMode of head.channelModes; let j = index">
                            <td><button class="action-btn red" (click)="deleteChannelMode(i, j)"><i class="fas fa-times"></i></button></td>
                            <td>{{channelMode.channels | channelNumberSum}}</td>
                            <td>
                                <table class="fullwidth">
                                    <thead>
                                        <tr>
                                            <td class="verysmallwidth"><button class="action-btn green" (click)="addChannel(i,j)"><i class="fas fa-plus"></i></button></td>
                                            <td>Channel</td>
                                            <td>Type</td>
                                            <td>Name</td>
                                            <td class="verysmallwidth"></td>
                                            <td>Config</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let channel of channelMode.channels; let k = index">
                                            <td><button class="action-btn red" (click)="deleteChannel(i, j, k)"><i class="fas fa-times"></i></button></td>
                                            <td class="editable" (click)="change('channelNumber', i, j, k)"><i class="fas fa-pen"></i> {{channel.startAddress}}{{channel.length > 1 ? " - " + (channel.startAddress + channel.length - 1) : ""}}</td>
                                            <td class="editable" (click)="change('channelType', i, j, k)"><i class="fas fa-pen"></i> {{channel.type}}</td>
                                            <td class="editable" (click)="change('channelName', i, j, k)"><i class="fas fa-pen"></i> {{channel.name}}</td>
                                            <td><button *ngIf="channel.type == 'Steps'" class="action-btn blue" (click)="toggleShowChannelConfig(i,j,k)"><i [class]='channel.showChannelConfig ? "fas fa-eye-slash" : "fas fa-eye"'></i></button></td>
                                            <td>
                                                <table  class="fullwidth" *ngIf="channel.showChannelConfig">
                                                    <thead>
                                                        <tr>
                                                            <td class="verysmallwidth double">
                                                                <button class="action-btn green" (click)="addChannelStep(i,j,k)"><i class="fas fa-plus"></i></button>
                                                                <button class="action-btn purple" *ngIf="!clipboard.length" (click)="copyChannelSteps(i,j,k)"><i class="fas fa-copy"></i></button>
                                                                <button class="action-btn purple" *ngIf="clipboard.length" (click)="pasteChannelSteps(i,j,k)"><i class="fas fa-paste"></i></button>
                                                                <button class="action-btn yellow" (click)="autoFillSteps(i,j,k)"><i class="fas fa-magic"></i></button>
                                                            </td>
                                                            <td>Start</td>
                                                            <td>End</td>
                                                            <td>Mode</td>
                                                            <td>Name</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let node of channel.steps; let l = index">
                                                            <td class="verysmallwidth"><button class="action-btn red" (click)="deleteChannelStep(i,j,k,l)"><i class="fas fa-times"></i></button></td>
                                                            <td class="editable" (click)="change('start', i, j, k, l)"><i class="fas fa-pen"></i> {{node.start}}</td>
                                                            <td class="">{{node.end}}</td>
                                                            <td class="editable" (click)="change('stepMode', i, j, k, l)"><i class="fas fa-pen"></i> {{node.mode}}</td>
                                                            <td class="editable" (click)="change('stepName', i, j, k, l)"><i class="fas fa-pen"></i> {{node.name}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </tbody>
</table>